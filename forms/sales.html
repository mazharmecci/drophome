<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ğŸ’° Sales</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="../images/DH-Black.png">
  <link rel="apple-touch-icon" href="../images/DH-Black.png">
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <!-- Injected Navbar -->
  <div id="navbar-placeholder"></div>
  <script src="../scripts/navbar.js" defer></script>

  <div class="history-container">
    <!-- we're using history container as standard for shipping, sales and order-history because of css settings-->

    <!-- Breadcrumb -->
    <nav class="breadcrumb-nav" aria-label="Breadcrumb">
      <ol class="breadcrumb-list">
        <li class="breadcrumb-item">
          <span>Sales</span>
        </li>
      </ol>
    </nav>

    <!-- Tabs -->
    <div class="tab-container">
      <button
        class="tab-btn active"
        data-tab="sales"
        title="View all product orders by date, product, and status. Includes pending and completed."
      >
        ğŸ“Š Sales Summary
      </button>
      <button
        class="tab-btn"
        data-tab="revenue"
        title="View completed orders only. Analyze revenue by account and month."
      >
        ğŸ’° Revenue Summary
      </button>
    </div>

    <!-- Explanation of tabs -->
    <button id="helpBtn" class="help-icon" title="What do these tabs do?">â„¹ï¸</button>
    <div id="helpModal" class="modal-overlay hidden">
      <div class="modal-content">
        <h3>ğŸ§­ Tab Behavior Summary</h3>
        <table class="modal-table">
          <thead>
            <tr>
              <th>Tab</th>
              <th>Purpose</th>
              <th>Filters Active</th>
              <th>Data Shown</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ğŸ“Š Sales Summary</td>
              <td>Track all product orders</td>
              <td>Product, Date Range</td>
              <td>All statuses (Pending + Completed)</td>
            </tr>
            <tr>
              <td>ğŸ’° Revenue Summary</td>
              <td>Analyze completed orders and revenue</td>
              <td>Account, Month</td>
              <td>Only de>OrderCompleted</code> entries</td>
            </tr>
            <tr>
              <td>âš™ï¸ Shared Status Filter</td>
              <td>Controls which order statuses are shown across both tabs</td>
              <td>Status (All, Completed, Pending)</td>
              <td>Applies globally to Sales and Revenue summaries</td>
            </tr>
          </tbody>
        </table>
        <div class="modal-actions">
          <button id="closeHelpBtn">Got it!</button>
        </div>
      </div>
    </div>

    <!-- Filters Wrapper -->
    <div class="filter-bar">
      <!-- Sales Filters -->
      <div id="sales-filters" class="filter-group active">
        <label>
          Product:
          <select id="filterProduct" class="filter-select">
            <option value="" disabled selected>Choose product ğŸ“¦</option>
          </select>
        </label>
        <label>
          From:
          <input id="filterStart" type="date" class="filter-date" />
        </label>
        <label>
          To:
          <input id="filterEnd" type="date" class="filter-date" />
        </label>
      </div>

      <!-- Revenue Filters -->
      <div id="revenue-filters" class="filter-group">
        <label>
          Account:
          <select id="filterAccount" class="filter-select">
            <option value="__all__" selected>All accounts ğŸ‘¤</option>
          </select>
        </label>
        <label>
          Month:
          <select id="filterMonth" class="filter-select">
            <option value="" disabled selected>Choose month ğŸ“…</option>
            <option value="01">January</option>
            <option value="02">February</option>
            <option value="03">March</option>
            <option value="04">April</option>
            <option value="05">May</option>
            <option value="06">June</option>
            <option value="07">July</option>
            <option value="08">August</option>
            <option value="09">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
          </select>
        </label>
      </div>

      <!-- Shared Status Filter -->
      <div class="filter-group">
        <label>
          Status:
          <select id="filterStatus" class="filter-select">
            <option value="__all__" selected>All Statuses</option>
            <option value="OrderCompleted">Order Completed</option>
            <option value="OrderPending">Order Pending</option>
          </select>
        </label>
      </div>

      <!-- Shared Reset Button -->
      <button id="resetFiltersBtn" class="btn-reset">ğŸ”„ Reset Filters</button>
    </div>

    <!-- Revenue Summary Section (now first) -->
    <section id="revenue" class="tab-content">
      <h2 class="table-title">ğŸ’° Revenue Summary â€“ Accounts, Labels & 3PL</h2>
      <div class="table-scroll-wrapper">
        <table class="summary-table">
          <thead>
            <tr>
              <th>ğŸ‘¤ Account</th>
              <th>ğŸ“¦ Product</th>
              <th>ğŸ“… Date</th>
              <th>ğŸ”¢ Quantity</th>
              <th>ğŸ·ï¸ Label Cost</th>
              <th>ğŸ·ï¸ Label Qty</th>
              <th>ğŸšš 3PL Cost</th>
            </tr>
          </thead>
          <tbody id="revenueSummaryBody">
            <!-- Injected dynamically by revenue.js -->
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3">Total</td>
              <td id="totalQtyCell">0</td>
              <td id="totalLabelCostCell">â‚¹0.00</td>
              <td>â€“</td>
              <td id="total3PLCostCell">â‚¹0.00</td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Action button to jump back to Sales -->
      <div class="table-actions">
        <button id="goToSalesBtn" class="btn-secondary">
          ğŸ“Š View Sales Summary
        </button>
      </div>
    </section>

    <!-- Sales Summary Section (now second, still active by default) -->
    <section id="sales" class="tab-content active">
      <h2 class="table-title">ğŸ“Š Sales Summary â€“ Orders by Product & Status</h2>
      <div class="table-scroll-wrapper">
        <table class="summary-table">
          <thead>
            <tr>
              <th>ğŸ“¦ Product</th>
              <th>ğŸ§‘â€ğŸ’¼ Account</th>
              <th>ğŸ“… Date</th>
              <th>ğŸ”¢ Quantity</th>
              <th>ğŸ“Œ Status</th>
            </tr>
          </thead>
          <tbody id="salesSummaryBody">
            <!-- Injected dynamically by dashboard.js -->
          </tbody>
        </table>
      </div>

      <!-- Action button to jump to Revenue -->
      <div class="table-actions">
        <button id="goToRevenueBtn" class="btn-secondary">
          ğŸ’° View Revenue Summary
        </button>
      </div>
    </section>
  </div> <!-- close history-container (or parent) -->

<!-- Scripts -->
<script type="module" src="../scripts/dashboard.js"></script>
<script type="module" src="../scripts/revenue.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tabs = document.querySelectorAll(".tab-btn");
    const contents = document.querySelectorAll(".tab-content");
    const salesFilters = document.getElementById("sales-filters");
    const revenueFilters = document.getElementById("revenue-filters");
    const resetBtn = document.getElementById("resetFiltersBtn");
    const goToRevenueBtn = document.getElementById("goToRevenueBtn");
    const goToSalesBtn = document.getElementById("goToSalesBtn");

    let activeTab = "sales";

    // Tab switching + filters + data reload + scroll
    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const targetId = tab.dataset.tab; // "sales" or "revenue"
        const section = document.getElementById(targetId);

        // 1) Active tab button / content
        tabs.forEach(t => t.classList.remove("active"));
        contents.forEach(c => c.classList.remove("active"));
        salesFilters.classList.remove("active");
        revenueFilters.classList.remove("active");

        tab.classList.add("active");
        if (section) section.classList.add("active");

        activeTab = targetId;

        // 2) Toggle filter groups + reload data for that tab
        if (activeTab === "sales") {
          salesFilters.classList.add("active");
          import("../scripts/dashboard.js").then(mod => mod.loadSalesSummary());
        } else {
          revenueFilters.classList.add("active");
          import("../scripts/revenue.js").then(mod => mod.loadRevenueSummary());
        }

        // 3) Scroll the active section into view
        if (section) {
          section.scrollIntoView({
            behavior: "smooth",
            block: "start"
          });
        }
      });
    });

    // Reset filters depending on active tab
    resetBtn.addEventListener("click", () => {
      if (activeTab === "sales") {
        document.getElementById("filterProduct").selectedIndex = 0;
        document.getElementById("filterStart").value = "";
        document.getElementById("filterEnd").value = "";
        import("../scripts/dashboard.js").then(mod => mod.loadSalesSummary());
      } else {
        document.getElementById("filterAccount").value = "__all__";
        const now = new Date();
        document.getElementById("filterMonth").value =
          String(now.getMonth() + 1).padStart(2, "0");
        import("../scripts/revenue.js").then(mod => mod.loadRevenueSummary());
      }
    });

    // "View Revenue Summary" button under Sales table
    if (goToRevenueBtn) {
      goToRevenueBtn.addEventListener("click", () => {
        const revenueTab = document.querySelector('.tab-btn[data-tab="revenue"]');
        const revenueSection = document.getElementById("revenue");
        if (!revenueTab || !revenueSection) return;

        revenueTab.click();
        revenueSection.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    }

    // "View Sales Summary" button under Revenue table
    if (goToSalesBtn) {
      goToSalesBtn.addEventListener("click", () => {
        const salesTab = document.querySelector('.tab-btn[data-tab="sales"]');
        const salesSection = document.getElementById("sales");
        if (!salesTab || !salesSection) return;

        salesTab.click();
        salesSection.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    }
  });
</script>

    <script>
  if (!sessionStorage.getItem("drophome-auth")) {
    window.location.href = "/drophome/forms/login.html";
  }
  </script>
    
</body>
</html>
